<!doctype html>

<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="pt-br"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="pt-br"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="pt-br"> <![endif]-->
<!--[if IE 9]>    <html class="no-js  ie9" lang="pt-br"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="pt-br"> <!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>{% block title%}Revolta da Salada{% endblock %}</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="{{ STATIC_URL }}libs/html5bp/normalize.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}libs/html5bp/main.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/common.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}libs/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}libs/bootstrap/css/bootstrap-responsive.css">
    {% block extra_css %}
        <style type="text/css">
            ul.thumbnails li.span4:nth-child(3n + 4) {
              margin-left : 0px;
            }
        </style>
    {% endblock %}
</head>

<body>

<header class="site-header min-layout-width" role="banner" id="site-header">
  <h1>#RevoltaDaSalada</h1>
</header>

<div role="main" id="main" class="container">
    {% block main_content %}{% endblock %}
    <div class="">
    <section>
    <div class="row" id="posts">
      {% for post in posts %}
          <div class="w">
            <div class="thumbnail">
              {% if post.cast.image_url %}
              <a href="{{post.url}}"><img alt="" style="" src="{{post.cast.image_url}}"></a>
              {% endif %}
              <div class="caption">
                <div class="media">
                    <div class="pull-left">
                        <img style="width: 40px; height: 40px;" src="{{post.author_thumbnail_url}}" />
                    </div>
                    <h3 class="media-body">{{post.author}}</h3>
                </div>
                <p>{{post.description|truncatechars:150}}</p>
              </div>
            </div>
          </div>
      {% endfor %}
      </div>
      </section>
  </div>
  <input type="hidden" class="page" value="1">
</div>

<footer class="site-footer min-layout-width" role="contentinfo">

</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}libs/masonry/masonry.pkgd.js"></script>
{% block extra_js %}
    <script type="text/javascript" >
        $(document).ready(function() {   
            // equalHeight($(".thumbnail")); 

              var $container = $('#posts');

              $container.masonry({
                itemSelector: '.w'
              });

              function truncate(str, len) {
                if(str.length < len) return str;
                return str.substring(0, len) + '...';
              }
              /*var LOADING = false;
              $(window).on('scroll', function(a, b, c) {
                if(!LOADING && ($(this).scrollTop() + $(this).height()) / $(document).height() > 0.85) {
                  LOADING = true;
                  $.getJSON('/posts', { page: parseInt($('.page').val()) + 1}, function(data) {
                    $('.page').val(data.page);
                    var items = [];
                    $.each(JSON.parse(data.posts), function(i, post) {
                      var item = '<div class="w">';
                      item += '<div class="thumbnail">';
                      if(post.image_url) {
                        item += '<a href="'+ post.url +'"><img alt="" style="" src="'+ post.image_url +'"></a>';
                      }
                      item += '<div class="caption">';
                      item += '<div class="media">';
                      item += '<div class="pull-left">';
                      item += '<img style="width: 40px; height: 40px;" src="'+ post.author_thumbnail_url +'" />';
                      item += '</div>';
                      item += '<h3 class="media-body">'+ post.author +'</h3>';
                      item += '</div>';
                      item += '<p>'+ truncate(post.description, 150) +'</p>';
                      item += '</div>';
                      item += '</div>';
                      item += '</div>';
                      items.push(item);
                    });
                    $('#posts').append(items);
                    LOADING = false;
                  });
                }
              });*/
        });
    </script>
{% endblock %}
</body>
</html>
